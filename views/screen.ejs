<!DOCTYPE html>
<html>
  <head>
    <title>ScreenTile <%= screenData === undefined ? '' : ': ' + screenData.id %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <script src="/javascripts/jquery.min.js"></script>
    <script src="/javascripts/screen.js"></script>

    <style media="screen">
      html, body {
        margin: 0;
        height: 100%;
        width: 100%;
        font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
      }
      body {
        /* default background */
        /* background: url('https://www.toptal.com/designers/subtlepatterns/images/transp_bg.png'); */
        background: #ccc;
      }

      #render {
        height: 100%;
        width: 100%;
        overflow: hidden;
      }

      #render .media {
        position: relative;
        top: -<%= screenData === undefined ? 0 : screenData.top %>px;
        left: -<%= screenData === undefined ? 0 : screenData.left %>px;
        transform-origin: top left;
        transform: scale(<%= screenData === undefined ? 1 : screenData.scale %>);
      }

      #render .media.single {
        top: 0 !important;
        left: 0 !important;
        /* reset scale? */
      }

      section#token-container {
        height: 100%;
        width: 100%;
        text-align: center;
        padding-top: 200px;
        position: absolute;
        top: 0;
        left: 0;
        font-size: 30px;
      }
      section#token-container .token {
        font-family: "Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace;
        font-size: 60px;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <!-- <div class="render" style=""></div> -->

    <section id="render">
      <img src="" class="media">
    </section>


    <section id="token-container" style="<%= screenData === undefined ? 'display: block;' : 'display: none;' %>">
      <% if (screenData === undefined) { %>
        <div class="message">Screen not yet defined in `screens.json`</div>
      <% } %>
      <div class="token"><%= screenToken %></div>
    </section>





    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      // sockets
      var socket = io.connect({
        reconnection: true,
        reconnectionDelay: 1000,
        reconnectionDelayMax : 5000,
        reconnectionAttempts: Infinity
      });

      socket.on('screen image', function(msg) {
        setImage(msg, "<%= screenToken %>");
      });

      socket.on('screen color', function(msg) {
        setColor(msg, "<%= screenToken %>");
      });

      socket.on('screen audio', function(msg) {
        switch(msg) {
          case 'pause':
            pauseAudio();
            break;
          case 'stop':
            stopAudio();
            break;
          default:
            setAudio(msg, "<%= screenToken %>");
        }
      });

      socket.on('screen instruction', function(msg) {
        switch(msg) {
          case 'refresh':
            location.reload();
            break;
          case 'show-token':
            $('#token-container').show();
            break;
          case 'hide-token':
            $('#token-container').hide();
            break;
          case 'mute':
            $('#render').hide();
            $('#token-container').hide();
            $('body').css('background', '#000');
            pauseAudio();
            break;
          case 'unmute':
            $('#render').show();
            $('body').css('background', '#ccc');
            playAudio();
            break;
          case 'css':
            handleCSS(msg);
            break;
          default:
            handleCSS(msg);

            console.log('Unkown `screen instruction` command');
        }
      });

      function handleCSS(msg) {
        console.log(msg);

        if (msg["token"] == "<%= screenToken %>") {
          $('#render .media').css("top", msg["top"]);
          $('#render .media').css("left", msg["left"]);
          $('#render .media').css("transform", "scale(" + msg["scale"] + ")");
        }
      }

    </script>


  </body>
</html>
